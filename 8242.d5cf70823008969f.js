"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[8242],{3442:(v,h,o)=>{o.d(h,{k:()=>r});const r={6:5,5:10,4:20,3:35,2:55}},2468:(v,h,o)=>{o.d(h,{D:()=>_});var r=o(5861),l=o(1571),g=o(9547),c=o(849);let _=(()=>{class e{constructor(a,n){this.gui=a,this.storage=n,this.gui.showPromiseLoader(this.initialize(),"Initializing Data Service...")}initialize(){var a=this;return(0,r.Z)(function*(){yield a.storage.create(),yield a.loadDataFromStorage()})()}get units(){var a;return(null===(a=this.data)||void 0===a?void 0:a.units)||[]}get warbands(){var a;return(null===(a=this.data)||void 0===a?void 0:a.warbands)||[]}get enhancedUnitCostRule(){var a;return(null===(a=this.data)||void 0===a?void 0:a.enhancedUnitCostRule)||!1}getUnitById(a){return this.units.find(t=>t.id===a)||null}setUnits(a){var n=this;return(0,r.Z)(function*(){n.data.units=a,n.gui.showPromiseLoader(n.saveDataToStorage(),"Saving Units...")})()}setWarbands(a){var n=this;return(0,r.Z)(function*(){n.data.warbands=a,n.gui.showPromiseLoader(n.saveDataToStorage(),"Saving Warbands...")})()}setEnhancedUnitCostRule(a){var n=this;return(0,r.Z)(function*(){n.data.enhancedUnitCostRule=a,n.gui.showPromiseLoader(n.saveDataToStorage(),"Saving Enhanced Unit Cost Rule...")})()}updateUnit(a){var n=this;return(0,r.Z)(function*(){const t=n.data.units.findIndex(i=>i.id===a.id);-1!==t&&(n.data.units[t]=a,n.gui.showPromiseLoader(n.saveDataToStorage(),"Updating Unit..."))})()}clearUnits(){var a=this;return(0,r.Z)(function*(){a.data.units=[],a.gui.showPromiseLoader(a.saveDataToStorage(),"Clearing Units...")})()}clearWarbands(){var a=this;return(0,r.Z)(function*(){a.data.warbands=[],a.gui.showPromiseLoader(a.saveDataToStorage(),"Clearing Warbands...")})()}saveDataToStorage(){var a=this;return(0,r.Z)(function*(){var n,t,i;yield a.storage.set("units",null===(n=a.data)||void 0===n?void 0:n.units),yield a.storage.set("warbands",null===(t=a.data)||void 0===t?void 0:t.warbands),yield a.storage.set("enhancedUnitCostRule",null===(i=a.data)||void 0===i?void 0:i.enhancedUnitCostRule)})()}loadDataFromStorage(){var a=this;return(0,r.Z)(function*(){const n=(yield a.storage.get("units"))||[],t=(yield a.storage.get("warbands"))||[],i=(yield a.storage.get("enhancedUnitCostRule"))||!1;a.data={units:n,warbands:t,enhancedUnitCostRule:i}})()}}return e.\u0275fac=function(a){return new(a||e)(l.LFG(g.m),l.LFG(c.K))},e.\u0275prov=l.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"}),e})()},9547:(v,h,o)=>{o.d(h,{m:()=>c});var r=o(5861),l=o(1571),g=o(7151);let c=(()=>{class _{constructor(u){this.loading=u}showPromiseLoader(u,a){var n=this;return(0,r.Z)(function*(){const t=yield n.loading.create({message:a||"Please wait..."});yield t.present();try{return yield u}finally{yield t.dismiss()}})()}}return _.\u0275fac=function(u){return new(u||_)(l.LFG(g.HT))},_.\u0275prov=l.Yz7({token:_,factory:_.\u0275fac,providedIn:"root"}),_})()},2218:(v,h,o)=>{o.d(h,{_:()=>e});var r=o(5861),l=o(1571),g=o(3442),c=o(2468),_=o(9547);let e=(()=>{class u{constructor(n,t){this.data=n,this.gui=t,this.changes=new l.vpe,this.warbands=[],this.enhancedUnitCostRule=!1,this.unitDraft=null,this.gui.showPromiseLoader(this.initialize(),"Initializing Unit Service...")}initialize(){var n=this;return(0,r.Z)(function*(){n.warbands=n.data.warbands||[],n.enhancedUnitCostRule=n.data.enhancedUnitCostRule||!1})()}get units(){return this.data.units}calcUnitCost(n){let t=g.k[n.rank];const i=n.edges.length;let d=0;for(let f=0;f<i;f++){const U=n.edges[f];U.cost>0&&(d++,this.enhancedUnitCostRule&&d>3&&(t+=10*(d-3))),t+=U.cost}return t}calcWarbandCost(n){let t=0;for(let i of n.units)t+=this.calcUnitCost(i.unit)*i.count;return t}getRankCost(n){return g.k[n.rank]}setEnhancedUnitCostRule(n){var t=this;return(0,r.Z)(function*(){t.enhancedUnitCostRule=n,yield t.data.setEnhancedUnitCostRule(n),t.changes.emit()})()}getEnhancedUnitCostRule(){var n=this;return(0,r.Z)(function*(){return n.enhancedUnitCostRule=n.data.enhancedUnitCostRule||!1,n.enhancedUnitCostRule})()}exportData(){return JSON.stringify({units:this.data.units,warbands:this.warbands,enhancedUnitCostRule:this.enhancedUnitCostRule},null,2)}importAndMergeData(n){var t=this;return(0,r.Z)(function*(){try{const i=JSON.parse(n),s=t.data.units.concat(i.units);return t.warbands=t.warbands.concat(i.warbands),yield t.data.setUnits(s),yield t.data.setWarbands(t.warbands),t.changes.emit(),!0}catch(i){return console.error("Error importing data:",i),!1}})()}importAndMergeUnitsOnly(n){var t=this;return(0,r.Z)(function*(){try{const i=JSON.parse(n),s=t.data.units.concat(i.units);return yield t.data.setUnits(s),t.changes.emit(),!0}catch(i){return console.error("Error importing data:",i),!1}})()}importAndMergeWarbandsOnly(n){var t=this;return(0,r.Z)(function*(){try{const i=JSON.parse(n);return t.warbands=t.warbands.concat(i.warbands),yield t.data.setWarbands(t.warbands),t.changes.emit(),!0}catch(i){return console.error("Error importing data:",i),!1}})()}importAndOverwriteData(n){var t=this;return(0,r.Z)(function*(){try{const i=JSON.parse(n),s=i.units;return t.warbands=i.warbands,t.enhancedUnitCostRule=i.enhancedUnitCostRule,yield t.data.setUnits(s),yield t.data.setWarbands(t.warbands),yield t.data.setEnhancedUnitCostRule(t.enhancedUnitCostRule),t.changes.emit(),!0}catch(i){return console.error("Error importing data:",i),!1}})()}generateID(){return Math.random().toString(36).substring(2,9)}addUnit(n){var t=this;return(0,r.Z)(function*(){const i=t.data.units.concat(n);yield t.data.setUnits(i),t.changes.emit()})()}purgeUnit(n){var t=this;return(0,r.Z)(function*(){const i=t.data.units.filter(s=>s.id!==n.id);t.warbands=t.warbands.map(s=>(s.units=s.units.filter(d=>d.unit.id!==n.id),s)),yield t.data.setUnits(i),yield t.data.setWarbands(t.warbands)})()}deleteUnit(n){var t=this;return(0,r.Z)(function*(){const i=t.data.units.filter(s=>s.id!==n.id);yield t.data.setUnits(i)})()}clearUnits(){var n=this;return(0,r.Z)(function*(){yield n.data.clearUnits(),n.changes.emit()})()}updateUnit(n){var t=this;return(0,r.Z)(function*(){t.data.updateUnit(n)})()}getUnitById(n){return this.data.getUnitById(n)}addWarband(n){var t=this;return(0,r.Z)(function*(){t.warbands.push(n),yield t.data.setWarbands(t.warbands)})()}getWarbands(){return this.warbands}createWarband(n){var t=this;return(0,r.Z)(function*(){const i={id:Date.now().toString(),...n};t.warbands.push(i),yield t.data.setWarbands(t.warbands)})()}updateWarband(n){var t=this;return(0,r.Z)(function*(){const i=t.warbands.findIndex(s=>s.id===n.id);i>-1&&(t.warbands[i]=n,yield t.data.setWarbands(t.warbands))})()}getWarbandById(n){const t=this.warbands.find(i=>i.id===n);return t?{...t}:null}removeWarband(n){var t=this;return(0,r.Z)(function*(){t.warbands=t.warbands.filter(i=>i!==n),yield t.data.setWarbands(t.warbands)})()}clearWarbands(){var n=this;return(0,r.Z)(function*(){yield n.data.clearWarbands(),n.warbands=[],n.changes.emit()})()}}return u.\u0275fac=function(n){return new(n||u)(l.LFG(c.D),l.LFG(_.m))},u.\u0275prov=l.Yz7({token:u,factory:u.\u0275fac,providedIn:"root"}),u})()},8242:(v,h,o)=>{o.r(h),o.d(h,{UnitViewPage:()=>n});var r=o(5861),l=o(6895),g=o(433),c=o(7151),_=o(4968),e=o(1571),u=o(2218);function a(t,i){if(1&t&&(e.TgZ(0,"li"),e._uU(1),e.qZA()),2&t){const s=i.$implicit;e.xp6(1),e.lnq(" ",s.name," (",s.cost,"pts): ",s.description," ")}}let n=(()=>{class t{constructor(s,d){this.modalController=s,this.unitService=d,this.backButton=null}ngOnInit(){var s=this;const d=(0,_.R)(document,"backbutton");this.backButton=d.subscribe((0,r.Z)(function*(){yield s.dismissModal()}))}ngOnDestroy(){var s;null===(s=this.backButton)||void 0===s||s.unsubscribe()}dismissModal(){var s=this;return(0,r.Z)(function*(){yield s.modalController.dismiss()})()}}return t.\u0275fac=function(s){return new(s||t)(e.Y36(c.IN),e.Y36(u._))},t.\u0275cmp=e.Xpm({type:t,selectors:[["app-unit-view"]],inputs:{unit:"unit"},standalone:!0,features:[e.jDz],decls:19,vars:7,consts:[["slot","end"],[3,"click"],[1,"unit-info"],[1,"unit-image",3,"src","alt"],[1,"unit-info-text"],[4,"ngFor","ngForOf"]],template:function(s,d){1&s&&(e.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),e._uU(3),e.qZA(),e.TgZ(4,"ion-buttons",0)(5,"ion-button",1),e.NdJ("click",function(){return d.dismissModal()}),e._uU(6,"Close"),e.qZA()()()(),e.TgZ(7,"ion-content")(8,"div",2),e._UZ(9,"img",3),e.TgZ(10,"div",4)(11,"p"),e._uU(12),e.qZA(),e.TgZ(13,"p"),e._uU(14),e.qZA(),e.TgZ(15,"p"),e._uU(16,"Edges:"),e.qZA(),e.TgZ(17,"ul"),e.YNc(18,a,2,3,"li",5),e.qZA()()()()),2&s&&(e.xp6(3),e.Oqu(d.unit.name),e.xp6(6),e.MGl("alt","",d.unit.name," image"),e.Q6J("src",d.unit.image||"assets/default-unit-image.png",e.LSH),e.xp6(3),e.hij("Total Cost: ",d.unitService.calcUnitCost(d.unit),"pts"),e.xp6(2),e.AsE("Rank: ",d.unit.rank,"+ (",d.unitService.getRankCost(d.unit),"pts)"),e.xp6(4),e.Q6J("ngForOf",d.unit.edges))},dependencies:[c.Pc,c.YG,c.Sm,c.W2,c.Gu,c.wd,c.sr,l.ez,l.sg,g.u5],styles:[".unit-image[_ngcontent-%COMP%]{max-width:100%;max-height:300px;object-fit:contain;display:block;margin:0 auto}.unit-info-text[_ngcontent-%COMP%]{margin-left:10px;margin-right:10px}"]}),t})()}}]);