"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[5891],{3442:(I,v,l)=>{l.d(v,{k:()=>o});const o={6:5,5:10,4:20,3:35,2:55}},3623:(I,v,l)=>{l.d(v,{_:()=>b});var o=l(5861),d=l(1571),h=l(3442),U=l(849);let w=(()=>{class t{constructor(e){this.storage=e,this.whenLocked=new d.vpe,this.whenUnlocked=new d.vpe,this._startedInitialization=!1,this._locked=!0}initialize(){var e=this;return(0,o.Z)(function*(){e._startedInitialization||(e._startedInitialization=!0,yield e.storage.create(),yield e.loadDataFromStorage(),e.unlock())})()}get locked(){return this._locked}get units(){var e;if(this.locked)throw new Error("DataService is locked!");return(null===(e=this.data)||void 0===e?void 0:e.units)||[]}get warbands(){var e;if(this.locked)throw new Error("DataService is locked!");return(null===(e=this.data)||void 0===e?void 0:e.warbands)||[]}get enhancedUnitCostRule(){var e;if(this.locked)throw new Error("DataService is locked!");return(null===(e=this.data)||void 0===e?void 0:e.enhancedUnitCostRule)||!1}getUnitById(e){return this.units.find(a=>a.id===e)||null}setUnits(e){var i=this;return(0,o.Z)(function*(){i.lock()||i.whenLocked.subscribe(()=>{i.setUnits(e)}),i.data.units=e,yield i.saveDataToStorage(),i.unlock()})()}setWarbands(e){var i=this;return(0,o.Z)(function*(){i.lock()||i.whenLocked.subscribe(()=>{i.setWarbands(e)}),i.data.warbands=e,yield i.saveDataToStorage(),i.unlock()})()}setEnhancedUnitCostRule(e){var i=this;return(0,o.Z)(function*(){i.lock()||i.whenLocked.subscribe(()=>{i.setEnhancedUnitCostRule(e)}),i.data.enhancedUnitCostRule=e,yield i.saveDataToStorage(),i.unlock()})()}updateUnit(e){var i=this;return(0,o.Z)(function*(){i.lock()||i.whenLocked.subscribe(()=>{i.updateUnit(e)});const a=i.data.units.findIndex(r=>r.id===e.id);-1!==a&&(i.data.units[a]=e,yield i.saveDataToStorage()),i.unlock()})()}clearUnits(){var e=this;return(0,o.Z)(function*(){e.lock()||e.whenLocked.subscribe(()=>{e.clearUnits()}),e.data.units=[],yield e.saveDataToStorage(),e.unlock()})()}clearWarbands(){var e=this;return(0,o.Z)(function*(){e.lock()||e.whenLocked.subscribe(()=>{e.clearWarbands()}),e.data.warbands=[],yield e.saveDataToStorage(),e.unlock()})()}saveDataToStorage(){var e=this;return(0,o.Z)(function*(){var i,a,r;yield e.storage.set("units",null===(i=e.data)||void 0===i?void 0:i.units),yield e.storage.set("warbands",null===(a=e.data)||void 0===a?void 0:a.warbands),yield e.storage.set("enhancedUnitCostRule",null===(r=e.data)||void 0===r?void 0:r.enhancedUnitCostRule)})()}loadDataFromStorage(){var e=this;return(0,o.Z)(function*(){const i=(yield e.storage.get("units"))||[],a=(yield e.storage.get("warbands"))||[],r=(yield e.storage.get("enhancedUnitCostRule"))||!1;e.data={units:i,warbands:a,enhancedUnitCostRule:r}})()}lock(){return!this._locked&&(this._locked=!0,this.whenLocked.emit(),!0)}unlock(){return!!this._locked&&(this._locked=!1,this.whenUnlocked.emit(),!0)}}return t.\u0275fac=function(e){return new(e||t)(d.LFG(U.K))},t.\u0275prov=d.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})(),b=(()=>{class t{constructor(e){this.data=e,this.changes=new d.vpe,this.warbands=[],this._startedInitialization=!1,this.enhancedUnitCostRule=!1,this.unitDraft=null}initialize(){var e=this;return(0,o.Z)(function*(){e._startedInitialization||(e._startedInitialization=!0,yield e.data.initialize(),e.warbands=e.data.warbands||[],e.enhancedUnitCostRule=e.data.enhancedUnitCostRule||!1)})()}checkInitialization(){if(!this._startedInitialization)throw new Error("You must call UnitService.initialize() before using this service!")}get units(){return this.data.units}calcUnitCost(e){this.checkInitialization();let i=h.k[e.rank];const a=e.edges.length;let f=0;for(let k=0;k<a;k++){const _=e.edges[k];_.cost>0&&(f++,this.enhancedUnitCostRule&&f>3&&(i+=10*(f-3))),i+=_.cost}return i}calcWarbandCost(e){this.checkInitialization();let i=0;for(let a of e.units)i+=this.calcUnitCost(a.unit)*a.count;return i}getRankCost(e){return this.checkInitialization(),h.k[e.rank]}setEnhancedUnitCostRule(e){var i=this;return(0,o.Z)(function*(){i.checkInitialization(),i.enhancedUnitCostRule=e,yield i.data.setEnhancedUnitCostRule(e),i.changes.emit()})()}getEnhancedUnitCostRule(){var e=this;return(0,o.Z)(function*(){return e.checkInitialization(),e.enhancedUnitCostRule=e.data.enhancedUnitCostRule||!1,e.enhancedUnitCostRule})()}exportData(){return JSON.stringify({units:this.data.units,warbands:this.warbands,enhancedUnitCostRule:this.enhancedUnitCostRule},null,2)}importAndMergeData(e){var i=this;return(0,o.Z)(function*(){i.checkInitialization();try{const a=JSON.parse(e),r=i.data.units.concat(a.units);return i.warbands=i.warbands.concat(a.warbands),yield i.data.setUnits(r),yield i.data.setWarbands(i.warbands),i.changes.emit(),!0}catch(a){return console.error("Error importing data:",a),!1}})()}importAndMergeUnitsOnly(e){var i=this;return(0,o.Z)(function*(){i.checkInitialization();try{const a=JSON.parse(e),r=i.data.units.concat(a.units);return yield i.data.setUnits(r),i.changes.emit(),!0}catch(a){return console.error("Error importing data:",a),!1}})()}importAndMergeWarbandsOnly(e){var i=this;return(0,o.Z)(function*(){i.checkInitialization();try{const a=JSON.parse(e);return i.warbands=i.warbands.concat(a.warbands),yield i.data.setWarbands(i.warbands),i.changes.emit(),!0}catch(a){return console.error("Error importing data:",a),!1}})()}importAndOverwriteData(e){var i=this;return(0,o.Z)(function*(){i.checkInitialization();try{const a=JSON.parse(e),r=a.units;return i.warbands=a.warbands,i.enhancedUnitCostRule=a.enhancedUnitCostRule,yield i.data.setUnits(r),yield i.data.setWarbands(i.warbands),yield i.data.setEnhancedUnitCostRule(i.enhancedUnitCostRule),i.changes.emit(),!0}catch(a){return console.error("Error importing data:",a),!1}})()}generateID(){return Math.random().toString(36).substring(2,9)}addUnit(e){var i=this;return(0,o.Z)(function*(){i.checkInitialization();const a=i.data.units.concat(e);yield i.data.setUnits(a),i.changes.emit()})()}purgeUnit(e){var i=this;return(0,o.Z)(function*(){i.checkInitialization();const a=i.data.units.filter(r=>r.id!==e.id);i.warbands=i.warbands.map(r=>(r.units=r.units.filter(f=>f.unit.id!==e.id),r)),yield i.data.setUnits(a),yield i.data.setWarbands(i.warbands)})()}deleteUnit(e){var i=this;return(0,o.Z)(function*(){const a=i.data.units.filter(r=>r.id!==e.id);yield i.data.setUnits(a)})()}clearUnits(){var e=this;return(0,o.Z)(function*(){yield e.data.clearUnits(),e.changes.emit()})()}updateUnit(e){var i=this;return(0,o.Z)(function*(){i.data.updateUnit(e)})()}getUnitById(e){return this.data.getUnitById(e)}addWarband(e){var i=this;return(0,o.Z)(function*(){i.checkInitialization(),i.warbands.push(e),yield i.data.setWarbands(i.warbands)})()}getWarbands(){return this.checkInitialization(),this.warbands}createWarband(e){var i=this;return(0,o.Z)(function*(){i.checkInitialization();const a={id:Date.now().toString(),...e};i.warbands.push(a),yield i.data.setWarbands(i.warbands)})()}updateWarband(e){var i=this;return(0,o.Z)(function*(){i.checkInitialization();const a=i.warbands.findIndex(r=>r.id===e.id);a>-1&&(i.warbands[a]=e,yield i.data.setWarbands(i.warbands))})()}getWarbandById(e){this.checkInitialization();const i=this.warbands.find(a=>a.id===e);return i?{...i}:null}removeWarband(e){var i=this;return(0,o.Z)(function*(){i.checkInitialization(),i.warbands=i.warbands.filter(a=>a!==e),yield i.data.setWarbands(i.warbands)})()}clearWarbands(){var e=this;return(0,o.Z)(function*(){e.checkInitialization(),yield e.data.clearWarbands(),e.warbands=[],e.changes.emit()})()}}return t.\u0275fac=function(e){return new(e||t)(d.LFG(w))},t.\u0275prov=d.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})()},5891:(I,v,l)=>{l.r(v),l.d(v,{UnitEditorPage:()=>C});var o=l(5861),d=l(7151),h=l(433);const U=[{name:"Armored",description:"Whenever this unit takes a hit roll one die, on a 4+ it is ignored (doesn\u2019t stack with cover terrain).",cost:15},{name:"Camouflaged",description:"This unit always counts as being in cover terrain.",cost:5},{name:"Tough I",description:"This model only rolls on the wounds table after accumulating 2 wounds and is only killed on a 7+.",cost:15},{name:"Tough II",description:"This model only rolls on the wounds table after accumulating 3 wounds and is only killed on an 8+.",cost:30},{name:"Fearless",description:"This unit may re-roll failed morale tests unless it is Stunned.",cost:10},{name:"Regeneration",description:"Whenever this unit would be killed roll one die, on a 4+ it is Stunned instead.",cost:20},{name:"Unwavering",description:"This unit is not routed by failed morale tests for losing half their army.",cost:5},{name:"Hit & Run",description:"When charging this unit may move back by 3\u201d after attacking, and enemies can\u2019t strike back.",cost:10},{name:"Intimidating",description:"Enemy units without this rule must take a morale test when in melee with it. If failed they must re-roll successful hits.",cost:10},{name:"Frenzy",description:"This unit may re-roll failed hit rolls in melee.",cost:5},{name:"Impact",description:"This unit gains one additional attack roll in melee when charging.",cost:5},{name:"Counter-Attack",description:"Enemies attacking this unit in melee that roll a 1 immediately take one hit themselves.",cost:5},{name:"Shooter I",description:'This unit may shoot with a range of 9".',cost:5},{name:"Shooter II",description:'This unit may shoot with a range of 18".',cost:10},{name:"Shooter III",description:'This unit may shoot with a range of 27".',cost:15},{name:"Deadly",description:"Whenever this unit rolls a 6 to hit it deals one automatic wound (can\u2019t be ignored by the armored rule).",cost:10},{name:"Fire/Poison",description:"When dealing wounds to an enemy add +1 to the wound roll.",cost:10},{name:"Freeze",description:"When dealing hits to an enemy roll one die, on a 4+ it may not move during its next activation.",cost:5},{name:"Powerful I",description:"This unit rolls 2 dice instead of 1 when attacking.",cost:10},{name:"Powerful II",description:"This unit rolls 3 dice instead of 1 when attacking.",cost:20},{name:"Indirect",description:"This unit may shoot through obstructions when any friendly unit has direct line of sight to the target (requires Shooter).",cost:5},{name:"Sniper",description:"When shooting, this unit ignores cover terrain effects (requires Shooter).",cost:5},{name:"Pinning",description:"Select a target and roll one die, on a 4+ the target and any units within 3\u201d each take a morale test. If failed, they must remain idle the next activation (requires Shooter).",cost:10},{name:"Leader",description:"When this unit is activated roll 3 dice, for each 4+ one friendly unit within 6\u201d may take one action.",cost:30},{name:"Death Blow",description:"If this unit is killed all units within 3\u201d take one automatic hit.",cost:5},{name:"Healer",description:"Whenever a friendly unit within 3\u201d would be killed roll one die, on a 4+ it is Stunned instead.",cost:10},{name:"Hero",description:'Friendly units within 12" of this unit may use its rank for morale tests unless it is Stunned.',cost:5},{name:"Large",description:"This unit may re-roll failed hits in melee against non-large units. Enemies may re-roll hits when shooting at it.",cost:0},{name:"Small",description:"This unit must re-roll hits in melee against non-small units. Enemies must re-roll hits when shooting at it.",cost:0},{name:"Fast",description:"This unit moves +2\u201d on advance and +4\u201d on rush/charge actions.",cost:5},{name:"Slow",description:"This unit moves -2\u201d on advance and -4\u201d on rush/charge actions.",cost:-5},{name:"Stealthy",description:"This unit is deployed after all non-stealthy units. Place it anywhere over 9\u201d away from enemy units, and if both players have stealthy units they must roll-off to see who deploys first.",cost:5},{name:"Strider",description:"This unit may move through difficult terrain as if it was open terrain.",cost:5},{name:"Flying",description:"This unit may move through units and obstacles, ignoring terrain effects.",cost:10},{name:"Aquatic",description:"This unit may move through water features as if it was open terrain.",cost:5},{name:"Wizard/Psychic",description:"This unit may cast one power at any time during its activation before attacking. Roll one die, on a 4+ apply one of these effects: \u2022 Fireball: Target enemy unit within 12\u201d takes one hit with Fire. \u2022 Ice Ray: Target enemy unit within 18\u201d takes one hit with Freeze.",cost:15}];var w=l(6895),b=l(3442),t=l(1571),y=l(3623),e=l(9430);const i=["fileInput"];function a(c,m){if(1&c&&(t.TgZ(0,"ion-select-option",15),t._uU(1),t.qZA()),2&c){const n=m.$implicit;t.Q6J("value",n),t.xp6(1),t.AsE(" ",n.value,"+ (",n.cost,"pts) ")}}function r(c,m){if(1&c&&(t.TgZ(0,"div",22)(1,"p"),t._uU(2),t.qZA()()),2&c){const n=t.oxw().$implicit;t.xp6(2),t.Oqu(n.description)}}function f(c,m){1&c&&t._UZ(0,"ion-icon",23)}const k=function(c){return{selected:c}};function _(c,m){if(1&c){const n=t.EpF();t.TgZ(0,"ion-item")(1,"div",18),t.NdJ("click",function(){const g=t.CHM(n).$implicit,p=t.oxw(2);return t.KtG(p.toggleEdgeExpansion(g))}),t.TgZ(2,"div"),t._uU(3),t.qZA(),t.YNc(4,r,3,1,"div",19),t.qZA(),t.TgZ(5,"div",20),t.NdJ("click",function(u){const p=t.CHM(n).$implicit;return t.oxw(2).toggleEdge(p),t.KtG(u.stopPropagation())}),t.YNc(6,f,1,0,"ion-icon",21),t.qZA()()}if(2&c){const n=m.$implicit,s=t.oxw(2);t.xp6(3),t.AsE("",n.name," (",n.cost,"pts)"),t.xp6(1),t.Q6J("ngIf",s.expandedRules.includes(n.name)),t.xp6(1),t.Q6J("ngClass",t.VKq(5,k,s.ruleIsSelected(n))),t.xp6(1),t.Q6J("ngIf",s.ruleIsSelected(n))}}function S(c,m){if(1&c&&(t.TgZ(0,"div",16),t.YNc(1,_,7,7,"ion-item",17),t.qZA()),2&c){const n=t.oxw();t.xp6(1),t.Q6J("ngForOf",n.edges)}}function T(c,m){if(1&c&&(t.TgZ(0,"ion-item")(1,"p"),t._uU(2),t.qZA()()),2&c){const n=t.oxw();t.xp6(2),t.AsE("",n.unitForm.value.name," will cost ",n.totalCost,"pts")}}function Z(c,m){if(1&c&&(t.TgZ(0,"ion-item")(1,"p"),t._uU(2),t.qZA()()),2&c){const n=t.oxw();t.xp6(2),t.AsE("",n.unitForm.value.name,"'s number of edges is ",n.unitForm.value.edges.length,"! The maximum is typically 3 by the standard rules. You can still create it, but it may not be allowed at some games.")}}let C=(()=>{class c{constructor(n,s,u){this.navCtrl=n,this.unitService=s,this.route=u,this.paramID=null,this.rankOptions=[],this.edges=U,this.edgesSelected=[],this.expandedRules=[],this.showRules=!1,this.editing=!1;for(let g in b.k)this.rankOptions.push({value:parseInt(g),cost:b.k[g]});this.unitForm=new h.cw({name:new h.NI("",h.kI.required),rank:new h.NI("",h.kI.required),edges:new h.NI([]),image:new h.NI("")})}ngOnInit(){var n=this;return(0,o.Z)(function*(){if(n.paramID=n.route.snapshot.queryParamMap.get("unitId"),n.paramID){n.editing=!0;const s=n.unitService.getUnitById(n.paramID);s&&(n.unitForm.patchValue({name:s.name,rank:n.rankOptions.find(u=>u.value===s.rank),edges:s.edges,image:s.image}),n.edgesSelected=s.edges)}})()}get unit(){const n=this.unitForm.value;return{id:this.editing?this.paramID:Math.random().toString(36).substring(2,9),name:n.name,rank:n.rank.value,edges:n.edges,image:n.image}}get totalCost(){return this.unitService.calcUnitCost(this.unit)}onSubmit(){this.editing?this.unitService.updateUnit(this.unit):this.unitService.addUnit(this.unit),this.navCtrl.navigateBack("/")}toggleEdgeExpansion(n){this.expandedRules.includes(n.name)?this.expandedRules=this.expandedRules.filter(s=>s!==n.name):this.expandedRules.push(n.name)}toggleShowRules(){this.showRules=!this.showRules}toggleEdge(n){this.ruleIsSelected(n)?this.removeEdge(n):this.addEdge(n)}addEdge(n){const s=this.edgesSelected.find(u=>u.name===n.name);s?(this.removeEdge(s),this.addEdge(n)):(this.edgesSelected.push(n),this.unitForm.controls.edges.setValue(this.edgesSelected))}removeEdge(n){this.edgesSelected=this.edgesSelected.filter(s=>s.name!==n.name),this.unitForm.controls.edges.setValue(this.edgesSelected)}ruleIsSelected(n){return this.edgesSelected.some(s=>s.name===n.name)}onFileChange(n){const s=n.target.files[0];if(!s)return;const u=new FileReader;u.onload=()=>{this.unitForm.controls.image.setValue(u.result)},u.readAsDataURL(s)}}return c.\u0275fac=function(n){return new(n||c)(t.Y36(d.SH),t.Y36(y._),t.Y36(e.gz))},c.\u0275cmp=t.Xpm({type:c,selectors:[["app-unit-editor"]],viewQuery:function(n,s){if(1&n&&t.Gf(i,5),2&n){let u;t.iGM(u=t.CRH())&&(s.fileInput=u.first)}},standalone:!0,features:[t.jDz],decls:30,vars:10,consts:[["slot","start"],[3,"formGroup","ngSubmit"],["formControlName","name","label","Unit Name"],["formControlName","rank","label","Rank"],[3,"value",4,"ngFor","ngForOf"],[3,"click"],["id","rules-list",4,"ngIf"],["formControlName","image","type","url","label","Image URL (optional)",2,"overflow","hidden"],["slot","end",3,"click"],["type","file","hidden","","accept","image/*",3,"change"],["fileInput",""],[2,"display","flex","justify-content","center"],[2,"max-width","100%","max-height","100px",3,"src"],[4,"ngIf"],["expand","block","type","submit",3,"disabled"],[3,"value"],["id","rules-list"],[4,"ngFor","ngForOf"],[2,"flex","1",3,"click"],["style","margin-left:20px",4,"ngIf"],["slot","end",1,"custom-checkbox",3,"ngClass","click"],["name","checkmark","style","color: white;",4,"ngIf"],[2,"margin-left","20px"],["name","checkmark",2,"color","white"]],template:function(n,s){if(1&n){const u=t.EpF();t.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),t._UZ(3,"ion-back-button"),t.qZA(),t.TgZ(4,"ion-title"),t._uU(5),t.qZA()()(),t.TgZ(6,"ion-content")(7,"form",1),t.NdJ("ngSubmit",function(){return s.onSubmit()}),t.TgZ(8,"ion-list")(9,"ion-item"),t._UZ(10,"ion-input",2),t.qZA(),t.TgZ(11,"ion-item")(12,"ion-select",3),t.YNc(13,a,2,3,"ion-select-option",4),t.qZA()(),t.TgZ(14,"ion-item",5),t.NdJ("click",function(){return s.toggleShowRules()}),t.TgZ(15,"ion-label"),t._uU(16),t.qZA()(),t.YNc(17,S,2,1,"div",6),t.TgZ(18,"ion-item"),t._UZ(19,"ion-input",7),t.TgZ(20,"ion-button",8),t.NdJ("click",function(){t.CHM(u);const p=t.MAs(23);return t.KtG(p.click())}),t._uU(21,"Upload"),t.qZA(),t.TgZ(22,"input",9,10),t.NdJ("change",function(p){return s.onFileChange(p)}),t.qZA()(),t.TgZ(24,"div",11),t._UZ(25,"img",12),t.qZA(),t.YNc(26,T,3,2,"ion-item",13),t.YNc(27,Z,3,2,"ion-item",13),t.qZA(),t.TgZ(28,"ion-button",14),t._uU(29),t.qZA()()()}2&n&&(t.xp6(5),t.hij("",s.editing?"Edit":"Create"," Unit"),t.xp6(2),t.Q6J("formGroup",s.unitForm),t.xp6(6),t.Q6J("ngForOf",s.rankOptions),t.xp6(3),t.hij("Edges (click to ",s.showRules?"hide":"show",")"),t.xp6(1),t.Q6J("ngIf",s.showRules),t.xp6(8),t.Q6J("src",s.unitForm.value.image||"assets/default-unit-image.png",t.LSH),t.xp6(1),t.Q6J("ngIf",s.unitForm.value.name&&s.unitForm.value.rank),t.xp6(1),t.Q6J("ngIf",s.unitForm.value.edges.length>3),t.xp6(1),t.Q6J("disabled",s.unitForm.invalid),t.xp6(1),t.hij("",s.editing?"Save":"Create"," Unit"))},dependencies:[d.Pc,d.oU,d.YG,d.Sm,d.W2,d.Gu,d.gu,d.pK,d.Ie,d.Q$,d.q_,d.t9,d.n0,d.wd,d.sr,d.QI,d.j9,d.cs,w.ez,w.mk,w.sg,w.O5,h.UX,h._Y,h.JJ,h.JL,h.sg,h.u],styles:["#rules-list[_ngcontent-%COMP%]{height:50vh;overflow-y:scroll;margin-left:40px}.custom-checkbox[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;width:30px;height:30px;border-radius:50%;background-color:#fff;border:2px solid var(--ion-color-primary);transition:background-color .3s}.custom-checkbox.selected[_ngcontent-%COMP%]{background-color:var(--ion-color-primary)}ion-item[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{text-align:center}"]}),c})()}}]);