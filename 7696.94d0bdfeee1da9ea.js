"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[7696],{3442:(g,h,o)=>{o.d(h,{k:()=>r});const r={6:5,5:10,4:20,3:35,2:55}},3623:(g,h,o)=>{o.d(h,{_:()=>f});var r=o(5861),s=o(1571),b=o(3442),e=o(849);let _=(()=>{class d{constructor(n){this.storage=n,this.whenLocked=new s.vpe,this.whenUnlocked=new s.vpe,this._startedInitialization=!1,this._locked=!0}initialize(){var n=this;return(0,r.Z)(function*(){n._startedInitialization||(n._startedInitialization=!0,yield n.storage.create(),yield n.loadDataFromStorage(),n.unlock())})()}get locked(){return this._locked}get units(){var n;if(this.locked)throw new Error("DataService is locked!");return(null===(n=this.data)||void 0===n?void 0:n.units)||[]}get warbands(){var n;if(this.locked)throw new Error("DataService is locked!");return(null===(n=this.data)||void 0===n?void 0:n.warbands)||[]}get enhancedUnitCostRule(){var n;if(this.locked)throw new Error("DataService is locked!");return(null===(n=this.data)||void 0===n?void 0:n.enhancedUnitCostRule)||!1}getUnitById(n){return this.units.find(a=>a.id===n)||null}setUnits(n){var t=this;return(0,r.Z)(function*(){t.lock()||t.whenLocked.subscribe(()=>{t.setUnits(n)}),t.data.units=n,yield t.saveDataToStorage(),t.unlock()})()}setWarbands(n){var t=this;return(0,r.Z)(function*(){t.lock()||t.whenLocked.subscribe(()=>{t.setWarbands(n)}),t.data.warbands=n,yield t.saveDataToStorage(),t.unlock()})()}setEnhancedUnitCostRule(n){var t=this;return(0,r.Z)(function*(){t.lock()||t.whenLocked.subscribe(()=>{t.setEnhancedUnitCostRule(n)}),t.data.enhancedUnitCostRule=n,yield t.saveDataToStorage(),t.unlock()})()}updateUnit(n){var t=this;return(0,r.Z)(function*(){t.lock()||t.whenLocked.subscribe(()=>{t.updateUnit(n)});const a=t.data.units.findIndex(i=>i.id===n.id);-1!==a&&(t.data.units[a]=n,yield t.saveDataToStorage()),t.unlock()})()}clearUnits(){var n=this;return(0,r.Z)(function*(){n.lock()||n.whenLocked.subscribe(()=>{n.clearUnits()}),n.data.units=[],yield n.saveDataToStorage(),n.unlock()})()}clearWarbands(){var n=this;return(0,r.Z)(function*(){n.lock()||n.whenLocked.subscribe(()=>{n.clearWarbands()}),n.data.warbands=[],yield n.saveDataToStorage(),n.unlock()})()}saveDataToStorage(){var n=this;return(0,r.Z)(function*(){var t,a,i;yield n.storage.set("units",null===(t=n.data)||void 0===t?void 0:t.units),yield n.storage.set("warbands",null===(a=n.data)||void 0===a?void 0:a.warbands),yield n.storage.set("enhancedUnitCostRule",null===(i=n.data)||void 0===i?void 0:i.enhancedUnitCostRule)})()}loadDataFromStorage(){var n=this;return(0,r.Z)(function*(){const t=(yield n.storage.get("units"))||[],a=(yield n.storage.get("warbands"))||[],i=(yield n.storage.get("enhancedUnitCostRule"))||!1;n.data={units:t,warbands:a,enhancedUnitCostRule:i}})()}lock(){return!this._locked&&(this._locked=!0,this.whenLocked.emit(),!0)}unlock(){return!!this._locked&&(this._locked=!1,this.whenUnlocked.emit(),!0)}}return d.\u0275fac=function(n){return new(n||d)(s.LFG(e.K))},d.\u0275prov=s.Yz7({token:d,factory:d.\u0275fac,providedIn:"root"}),d})(),f=(()=>{class d{constructor(n){this.data=n,this.changes=new s.vpe,this.warbands=[],this._startedInitialization=!1,this.enhancedUnitCostRule=!1,this.unitDraft=null}initialize(){var n=this;return(0,r.Z)(function*(){n._startedInitialization||(n._startedInitialization=!0,yield n.data.initialize(),n.warbands=n.data.warbands||[],n.enhancedUnitCostRule=n.data.enhancedUnitCostRule||!1)})()}checkInitialization(){if(!this._startedInitialization)throw new Error("You must call UnitService.initialize() before using this service!")}get units(){return this.data.units}calcUnitCost(n){this.checkInitialization();let t=b.k[n.rank];const a=n.edges.length;let l=0;for(let u=0;u<a;u++){const v=n.edges[u];v.cost>0&&(l++,this.enhancedUnitCostRule&&l>3&&(t+=10*(l-3))),t+=v.cost}return t}calcWarbandCost(n){this.checkInitialization();let t=0;for(let a of n.units)t+=this.calcUnitCost(a.unit)*a.count;return t}getRankCost(n){return this.checkInitialization(),b.k[n.rank]}setEnhancedUnitCostRule(n){var t=this;return(0,r.Z)(function*(){t.checkInitialization(),t.enhancedUnitCostRule=n,yield t.data.setEnhancedUnitCostRule(n),t.changes.emit()})()}getEnhancedUnitCostRule(){var n=this;return(0,r.Z)(function*(){return n.checkInitialization(),n.enhancedUnitCostRule=n.data.enhancedUnitCostRule||!1,n.enhancedUnitCostRule})()}exportData(){return JSON.stringify({units:this.data.units,warbands:this.warbands,enhancedUnitCostRule:this.enhancedUnitCostRule},null,2)}importAndMergeData(n){var t=this;return(0,r.Z)(function*(){t.checkInitialization();try{const a=JSON.parse(n),i=t.data.units.concat(a.units);return t.warbands=t.warbands.concat(a.warbands),yield t.data.setUnits(i),yield t.data.setWarbands(t.warbands),t.changes.emit(),!0}catch(a){return console.error("Error importing data:",a),!1}})()}importAndMergeUnitsOnly(n){var t=this;return(0,r.Z)(function*(){t.checkInitialization();try{const a=JSON.parse(n),i=t.data.units.concat(a.units);return yield t.data.setUnits(i),t.changes.emit(),!0}catch(a){return console.error("Error importing data:",a),!1}})()}importAndMergeWarbandsOnly(n){var t=this;return(0,r.Z)(function*(){t.checkInitialization();try{const a=JSON.parse(n);return t.warbands=t.warbands.concat(a.warbands),yield t.data.setWarbands(t.warbands),t.changes.emit(),!0}catch(a){return console.error("Error importing data:",a),!1}})()}importAndOverwriteData(n){var t=this;return(0,r.Z)(function*(){t.checkInitialization();try{const a=JSON.parse(n),i=a.units;return t.warbands=a.warbands,t.enhancedUnitCostRule=a.enhancedUnitCostRule,yield t.data.setUnits(i),yield t.data.setWarbands(t.warbands),yield t.data.setEnhancedUnitCostRule(t.enhancedUnitCostRule),t.changes.emit(),!0}catch(a){return console.error("Error importing data:",a),!1}})()}generateID(){return Math.random().toString(36).substring(2,9)}addUnit(n){var t=this;return(0,r.Z)(function*(){t.checkInitialization();const a=t.data.units.concat(n);yield t.data.setUnits(a),t.changes.emit()})()}purgeUnit(n){var t=this;return(0,r.Z)(function*(){t.checkInitialization();const a=t.data.units.filter(i=>i.id!==n.id);t.warbands=t.warbands.map(i=>(i.units=i.units.filter(l=>l.unit.id!==n.id),i)),yield t.data.setUnits(a),yield t.data.setWarbands(t.warbands)})()}deleteUnit(n){var t=this;return(0,r.Z)(function*(){const a=t.data.units.filter(i=>i.id!==n.id);yield t.data.setUnits(a)})()}clearUnits(){var n=this;return(0,r.Z)(function*(){yield n.data.clearUnits(),n.changes.emit()})()}updateUnit(n){var t=this;return(0,r.Z)(function*(){t.data.updateUnit(n)})()}getUnitById(n){return this.data.getUnitById(n)}addWarband(n){var t=this;return(0,r.Z)(function*(){t.checkInitialization(),t.warbands.push(n),yield t.data.setWarbands(t.warbands)})()}getWarbands(){return this.checkInitialization(),this.warbands}createWarband(n){var t=this;return(0,r.Z)(function*(){t.checkInitialization();const a={id:Date.now().toString(),...n};t.warbands.push(a),yield t.data.setWarbands(t.warbands)})()}updateWarband(n){var t=this;return(0,r.Z)(function*(){t.checkInitialization();const a=t.warbands.findIndex(i=>i.id===n.id);a>-1&&(t.warbands[a]=n,yield t.data.setWarbands(t.warbands))})()}getWarbandById(n){this.checkInitialization();const t=this.warbands.find(a=>a.id===n);return t?{...t}:null}removeWarband(n){var t=this;return(0,r.Z)(function*(){t.checkInitialization(),t.warbands=t.warbands.filter(a=>a!==n),yield t.data.setWarbands(t.warbands)})()}clearWarbands(){var n=this;return(0,r.Z)(function*(){n.checkInitialization(),yield n.data.clearWarbands(),n.warbands=[],n.changes.emit()})()}}return d.\u0275fac=function(n){return new(n||d)(s.LFG(_))},d.\u0275prov=s.Yz7({token:d,factory:d.\u0275fac,providedIn:"root"}),d})()},7696:(g,h,o)=>{o.r(h),o.d(h,{WarbandsListPage:()=>d});var r=o(5861),s=o(7151),b=o(6895),e=o(1571),_=o(3623);function f(c,n){if(1&c){const t=e.EpF();e.TgZ(0,"ion-item")(1,"ion-label")(2,"h2"),e._uU(3),e.qZA(),e.TgZ(4,"p"),e._uU(5),e.qZA()(),e.TgZ(6,"ion-buttons",5)(7,"ion-button",3),e.NdJ("click",function(){const l=e.CHM(t).$implicit,u=e.oxw();return e.KtG(u.viewWarbandDetails(l))}),e._UZ(8,"ion-icon",6),e.qZA(),e.TgZ(9,"ion-button",3),e.NdJ("click",function(){const l=e.CHM(t).$implicit,u=e.oxw();return e.KtG(u.editWarband(l))}),e._UZ(10,"ion-icon",7),e.qZA(),e.TgZ(11,"ion-button",3),e.NdJ("click",function(){const l=e.CHM(t).$implicit,u=e.oxw();return e.KtG(u.presentRemoveWarbandAlert(l))}),e._UZ(12,"ion-icon",8),e.qZA()()()}if(2&c){const t=n.$implicit,a=e.oxw();e.xp6(3),e.AsE("",t.name," [",a.unitService.calcWarbandCost(t),"pts]"),e.xp6(2),e.Oqu(t.description)}}let d=(()=>{class c{constructor(t,a,i){this.navCtrl=t,this.unitService=a,this.alertController=i,this.warbands=[]}ngOnInit(){var t=this;return(0,r.Z)(function*(){yield t.unitService.initialize(),t.loadWarbands()})()}ionViewWillEnter(){var t=this;return(0,r.Z)(function*(){t.loadWarbands()})()}loadWarbands(){this.warbands=this.unitService.getWarbands()}viewWarbandDetails(t){this.navCtrl.navigateForward("/warband-view",{queryParams:{id:t.id}})}createNewWarband(){this.navCtrl.navigateForward("/warband-editor")}editWarband(t){this.navCtrl.navigateForward("/warband-editor",{queryParams:{warbandId:t.id}})}removeWarband(t){this.unitService.removeWarband(t),this.loadWarbands()}presentRemoveWarbandAlert(t){var a=this;return(0,r.Z)(function*(){yield(yield a.alertController.create({header:"Delete Warband",message:"Are you sure you want to delete this warband?",buttons:[{text:"Cancel",role:"cancel"},{text:"Delete",handler:()=>{a.removeWarband(t)}}]})).present()})()}}return c.\u0275fac=function(t){return new(t||c)(e.Y36(s.SH),e.Y36(_._),e.Y36(s.Br))},c.\u0275cmp=e.Xpm({type:c,selectors:[["app-warbands-list"]],standalone:!0,features:[e.jDz],decls:12,vars:1,consts:[["slot","start"],[4,"ngFor","ngForOf"],["vertical","bottom","horizontal","end","slot","fixed"],[3,"click"],["name","add"],["slot","end"],["slot","icon-only","name","eye"],["slot","icon-only","name","pencil"],["slot","icon-only","name","trash"]],template:function(t,a){1&t&&(e.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),e._UZ(3,"ion-back-button"),e.qZA(),e.TgZ(4,"ion-title"),e._uU(5,"Warbands List"),e.qZA()()(),e.TgZ(6,"ion-content")(7,"ion-list"),e.YNc(8,f,13,3,"ion-item",1),e.qZA(),e.TgZ(9,"ion-fab",2)(10,"ion-fab-button",3),e.NdJ("click",function(){return a.createNewWarband()}),e._UZ(11,"ion-icon",4),e.qZA()()()),2&t&&(e.xp6(8),e.Q6J("ngForOf",a.warbands))},dependencies:[s.Pc,s.oU,s.YG,s.Sm,s.W2,s.IJ,s.W4,s.Gu,s.gu,s.Ie,s.Q$,s.q_,s.wd,s.sr,s.cs,b.ez,b.sg]}),c})()}}]);