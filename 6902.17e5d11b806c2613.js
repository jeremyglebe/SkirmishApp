"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[6902],{6902:(v,c,s)=>{s.r(c),s.d(c,{WarbandEditorPage:()=>x});var p=s(5861),d=s(6895),u=s(433),e=s(7151),b=s(2408),t=s(1571),h=s(9430),f=s(2218);function U(r,_){if(1&r){const n=t.EpF();t.TgZ(0,"ion-input",10),t.NdJ("input",function(a){t.CHM(n);const o=t.oxw().$implicit,l=t.oxw();return t.KtG(l.onUnitCountInput(o.id,a))})("click",function(a){t.CHM(n);const o=t.oxw(2);return t.KtG(o.onUnitCountClick(a))}),t.qZA()}if(2&r){const n=t.oxw().$implicit,i=t.oxw();t.Q6J("placeholder",i.getUnitCount(n))}}function C(r,_){if(1&r){const n=t.EpF();t.TgZ(0,"ion-item")(1,"ion-avatar",6),t.NdJ("click",function(){const o=t.CHM(n).$implicit,l=t.oxw();return t.KtG(l.viewUnit(o))}),t._UZ(2,"img",7),t.qZA(),t.TgZ(3,"ion-checkbox",8),t.NdJ("ionChange",function(){const o=t.CHM(n).$implicit,l=t.oxw();return t.KtG(l.toggleUnitSelection(o))}),t._uU(4),t._UZ(5,"br"),t._uU(6),t._UZ(7,"br"),t._uU(8),t.qZA(),t.YNc(9,U,1,1,"ion-input",9),t.qZA()}if(2&r){const n=_.$implicit,i=t.oxw();t.xp6(2),t.Q6J("src",n.image||"assets/default-unit-image.png",t.LSH),t.xp6(1),t.Q6J("checked",i.isUnitInWarband(n)),t.xp6(1),t.hij(" ",n.name,""),t.xp6(2),t.hij(" Quality: ",n.quality,""),t.xp6(2),t.hij(" Cost: ",i.unitService.calcUnitCost(n),"pts "),t.xp6(1),t.Q6J("ngIf",i.isUnitInWarband(n))}}let x=(()=>{class r{constructor(n,i,a,o,l){this.navCtrl=n,this.route=i,this.fb=a,this.unitService=o,this.modalController=l,this.allUnits=[],this.allUnits=this.unitService.getUnits(),this.paramID=this.route.snapshot.queryParamMap.get("warbandId");const m={id:"",name:"",description:"",units:[]};if(this.paramID){const g=this.unitService.getWarbandById(this.paramID);this.warband=g||m}else this.warband=m;this.warbandForm=this.fb.group({name:[this.warband.name,u.kI.required],description:[this.warband.description,u.kI.required]}),this.units=this.warband.units}toggleUnitSelection(n){const i=this.units.findIndex(a=>a.unit.id===n.id);-1===i?this.units.push({unit:n,count:1}):this.units.splice(i,1)}saveWarband(){var n=this;return(0,p.Z)(function*(){const i={...n.warbandForm.value,units:n.units};n.paramID?n.unitService.updateWarband({...n.warband,...i}):n.unitService.createWarband(i),n.navCtrl.navigateBack("/warbands-list")})()}viewUnit(n){var i=this;return(0,p.Z)(function*(){yield(yield i.modalController.create({component:b.ViewUnitPage,componentProps:{unit:n}})).present()})()}isUnitInWarband(n){return this.units.some(i=>i.unit.id===n.id)}getUnitCount(n){const i=this.units.findIndex(a=>a.unit.id===n.id);return-1!==i?this.units[i].count:0}onUnitCountClick(n){n.target.value=""}onUnitCountInput(n,i){const a=i.target.valueAsNumber;if(console.log(a),!isNaN(a)){const o=this.units.findIndex(l=>l.unit.id===n);-1!==o&&(this.units[o].count=a)}}}return r.\u0275fac=function(n){return new(n||r)(t.Y36(e.SH),t.Y36(h.gz),t.Y36(u.qu),t.Y36(f._),t.Y36(e.IN))},r.\u0275cmp=t.Xpm({type:r,selectors:[["app-warband-editor"]],standalone:!0,features:[t.jDz],decls:26,vars:5,consts:[["slot","start"],[3,"formGroup"],["formControlName","name","label","Warband Name"],["formControlName","description","label","Warband Description"],[4,"ngFor","ngForOf"],["expand","full",3,"disabled","click"],["slot","start",3,"click"],[3,"src"],["labelPlacement","start",3,"checked","ionChange"],["type","number","min","1","label","","labelPlacement","stacked","class","count-input",3,"placeholder","input","click",4,"ngIf"],["type","number","min","1","label","","labelPlacement","stacked",1,"count-input",3,"placeholder","input","click"]],template:function(n,i){1&n&&(t.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),t._UZ(3,"ion-back-button"),t.qZA(),t.TgZ(4,"ion-title"),t._uU(5),t.qZA()()(),t.TgZ(6,"ion-content")(7,"form",1)(8,"ion-item"),t._UZ(9,"ion-input",2),t.qZA(),t.TgZ(10,"ion-item"),t._UZ(11,"ion-textarea",3),t.qZA()(),t.TgZ(12,"ion-item")(13,"ion-label"),t._uU(14,"Warband Cost:"),t.qZA(),t.TgZ(15,"ion-text"),t._uU(16),t.qZA()(),t.TgZ(17,"ion-list-header")(18,"ion-label"),t._uU(19,"Available Units"),t.qZA()(),t.TgZ(20,"ion-list")(21,"ion-item"),t._uU(22,"Click on a unit's avatar to view it's full description."),t.qZA(),t.YNc(23,C,10,6,"ion-item",4),t.qZA(),t.TgZ(24,"ion-button",5),t.NdJ("click",function(){return i.saveWarband()}),t._uU(25,"Save Warband"),t.qZA()()),2&n&&(t.xp6(5),t.Oqu(i.paramID?"Edit Warband":"Create Warband"),t.xp6(2),t.Q6J("formGroup",i.warbandForm),t.xp6(9),t.hij("",i.unitService.calcWarbandCost(i.warband),"pts"),t.xp6(7),t.Q6J("ngForOf",i.allUnits),t.xp6(1),t.Q6J("disabled",!i.warbandForm.valid))},dependencies:[e.Pc,e.BJ,e.oU,e.YG,e.Sm,e.nz,e.W2,e.Gu,e.pK,e.Ie,e.Q$,e.q_,e.yh,e.yW,e.g2,e.wd,e.sr,e.w,e.as,e.j9,e.cs,d.ez,d.sg,d.O5,u.UX,u._Y,u.JJ,u.JL,u.sg,u.u,u.u5],styles:[".count-input[_ngcontent-%COMP%]{--padding-start: 0;--padding-end: 0;width:50px;max-height:50px;font-size:1.1em;font-weight:700;text-align:center;border:2px solid white;border-radius:8px;margin-left:12px}"]}),r})()}}]);