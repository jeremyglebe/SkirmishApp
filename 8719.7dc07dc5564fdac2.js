"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[8719],{3442:(U,g,o)=>{o.d(g,{k:()=>r});const r={6:5,5:10,4:20,3:35,2:55}},8719:(U,g,o)=>{o.r(g),o.d(g,{CreateUnitDetailsPage:()=>e});var r=o(6895),l=o(433),d=o(7151),i=o(1571),_=o(2218);const h=["fileInput"],u=["unitImage"];let e=(()=>{class n{constructor(a,s){this.navCtrl=a,this.units=s}ngOnInit(){this.units.unitDraft={id:this.units.generateID(),name:"",rank:0,edges:[]}}onFileChange(a){const s=a.target.files[0];if(!s)return;const c=new FileReader;c.onload=()=>{const f=c.result;this.units.unitDraft.image=f,this.unitImage.nativeElement.src=f},c.readAsDataURL(s)}onNameChange(a){this.units.unitDraft.name=a.target.value}onProceed(){this.units.addUnit(this.units.unitDraft),this.units.unitDraft=null,this.navCtrl.navigateRoot("/",{animated:!0,animationDirection:"back"})}}return n.\u0275fac=function(a){return new(a||n)(i.Y36(d.SH),i.Y36(_._))},n.\u0275cmp=i.Xpm({type:n,selectors:[["app-create-unit-details"]],viewQuery:function(a,s){if(1&a&&(i.Gf(h,5),i.Gf(u,5)),2&a){let c;i.iGM(c=i.CRH())&&(s.fileInput=c.first),i.iGM(c=i.CRH())&&(s.unitImage=c.first)}},standalone:!0,features:[i.jDz],decls:24,vars:0,consts:[["slot","start"],[1,"ion-justify-content-center"],["size","8"],["id","unit-image","src","assets/default-unit-image.png",3,"click"],["unitImage",""],["type","file","hidden","","accept","image/*",3,"change"],["fileInput",""],[1,"center-text"],["label","Unit Name","placeholder","please enter a name...",3,"change"],["size","6"],["expand","full",3,"click"]],template:function(a,s){if(1&a){const c=i.EpF();i.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),i._UZ(3,"ion-back-button"),i.qZA(),i.TgZ(4,"ion-title"),i._uU(5,"Create Unit"),i.qZA()()(),i.TgZ(6,"ion-content")(7,"ion-grid")(8,"ion-row",1)(9,"ion-col",2)(10,"img",3,4),i.NdJ("click",function(){i.CHM(c);const v=i.MAs(13);return i.KtG(v.click())}),i.qZA(),i.TgZ(12,"input",5,6),i.NdJ("change",function(v){return s.onFileChange(v)}),i.qZA(),i.TgZ(14,"p",7)(15,"i"),i._uU(16,"Tap image to change"),i.qZA()()()(),i.TgZ(17,"ion-row",1)(18,"ion-col",2)(19,"ion-input",8),i.NdJ("change",function(v){return s.onNameChange(v)}),i.qZA()()(),i.TgZ(20,"ion-row",1)(21,"ion-col",9)(22,"ion-button",10),i.NdJ("click",function(){return s.onProceed()}),i._uU(23,"Proceed"),i.qZA()()()()()}},dependencies:[d.Pc,d.oU,d.YG,d.Sm,d.wI,d.W2,d.jY,d.Gu,d.pK,d.Nd,d.wd,d.sr,d.j9,d.cs,r.ez,l.u5],styles:["#unit-image[_ngcontent-%COMP%]{max-height:30vh;display:block;margin-left:auto;margin-right:auto}.center-text[_ngcontent-%COMP%]{text-align:center}"]}),n})()},2468:(U,g,o)=>{o.d(g,{D:()=>_});var r=o(5861),l=o(1571),d=o(9547),i=o(849);let _=(()=>{class h{constructor(e,n){this.gui=e,this.storage=n,this.gui.showPromiseLoader(this.initialize(),"Initializing Data Service...")}initialize(){var e=this;return(0,r.Z)(function*(){yield e.storage.create(),yield e.loadDataFromStorage()})()}get units(){var e;return(null===(e=this.data)||void 0===e?void 0:e.units)||[]}get warbands(){var e;return(null===(e=this.data)||void 0===e?void 0:e.warbands)||[]}get enhancedUnitCostRule(){var e;return(null===(e=this.data)||void 0===e?void 0:e.enhancedUnitCostRule)||!1}getUnitById(e){return this.units.find(t=>t.id===e)||null}setUnits(e){var n=this;return(0,r.Z)(function*(){n.data.units=e,n.gui.showPromiseLoader(n.saveDataToStorage(),"Saving Units...")})()}setWarbands(e){var n=this;return(0,r.Z)(function*(){n.data.warbands=e,n.gui.showPromiseLoader(n.saveDataToStorage(),"Saving Warbands...")})()}setEnhancedUnitCostRule(e){var n=this;return(0,r.Z)(function*(){n.data.enhancedUnitCostRule=e,n.gui.showPromiseLoader(n.saveDataToStorage(),"Saving Enhanced Unit Cost Rule...")})()}updateUnit(e){var n=this;return(0,r.Z)(function*(){const t=n.data.units.findIndex(a=>a.id===e.id);-1!==t&&(n.data.units[t]=e,n.gui.showPromiseLoader(n.saveDataToStorage(),"Updating Unit..."))})()}clearUnits(){var e=this;return(0,r.Z)(function*(){e.data.units=[],e.gui.showPromiseLoader(e.saveDataToStorage(),"Clearing Units...")})()}clearWarbands(){var e=this;return(0,r.Z)(function*(){e.data.warbands=[],e.gui.showPromiseLoader(e.saveDataToStorage(),"Clearing Warbands...")})()}saveDataToStorage(){var e=this;return(0,r.Z)(function*(){var n,t,a;yield e.storage.set("units",null===(n=e.data)||void 0===n?void 0:n.units),yield e.storage.set("warbands",null===(t=e.data)||void 0===t?void 0:t.warbands),yield e.storage.set("enhancedUnitCostRule",null===(a=e.data)||void 0===a?void 0:a.enhancedUnitCostRule)})()}loadDataFromStorage(){var e=this;return(0,r.Z)(function*(){const n=(yield e.storage.get("units"))||[],t=(yield e.storage.get("warbands"))||[],a=(yield e.storage.get("enhancedUnitCostRule"))||!1;e.data={units:n,warbands:t,enhancedUnitCostRule:a}})()}}return h.\u0275fac=function(e){return new(e||h)(l.LFG(d.m),l.LFG(i.K))},h.\u0275prov=l.Yz7({token:h,factory:h.\u0275fac,providedIn:"root"}),h})()},9547:(U,g,o)=>{o.d(g,{m:()=>i});var r=o(5861),l=o(1571),d=o(7151);let i=(()=>{class _{constructor(u){this.loading=u}showPromiseLoader(u,e){var n=this;return(0,r.Z)(function*(){const t=yield n.loading.create({message:e||"Please wait..."});yield t.present();try{return yield u}finally{yield t.dismiss()}})()}}return _.\u0275fac=function(u){return new(u||_)(l.LFG(d.HT))},_.\u0275prov=l.Yz7({token:_,factory:_.\u0275fac,providedIn:"root"}),_})()},2218:(U,g,o)=>{o.d(g,{_:()=>h});var r=o(5861),l=o(1571),d=o(3442),i=o(2468),_=o(9547);let h=(()=>{class u{constructor(n,t){this.data=n,this.gui=t,this.changes=new l.vpe,this.warbands=[],this.enhancedUnitCostRule=!1,this.unitDraft=null,this.gui.showPromiseLoader(this.initialize(),"Initializing Unit Service...")}initialize(){var n=this;return(0,r.Z)(function*(){n.warbands=n.data.warbands||[],n.enhancedUnitCostRule=n.data.enhancedUnitCostRule||!1})()}get units(){return this.data.units}calcUnitCost(n){let t=d.k[n.rank];const a=n.edges.length;let c=0;for(let f=0;f<a;f++){const v=n.edges[f];v.cost>0&&(c++,this.enhancedUnitCostRule&&c>3&&(t+=10*(c-3))),t+=v.cost}return t}calcWarbandCost(n){let t=0;for(let a of n.units)t+=this.calcUnitCost(a.unit)*a.count;return t}getRankCost(n){return d.k[n.rank]}setEnhancedUnitCostRule(n){var t=this;return(0,r.Z)(function*(){t.enhancedUnitCostRule=n,yield t.data.setEnhancedUnitCostRule(n),t.changes.emit()})()}getEnhancedUnitCostRule(){var n=this;return(0,r.Z)(function*(){return n.enhancedUnitCostRule=n.data.enhancedUnitCostRule||!1,n.enhancedUnitCostRule})()}exportData(){return JSON.stringify({units:this.data.units,warbands:this.warbands,enhancedUnitCostRule:this.enhancedUnitCostRule},null,2)}importAndMergeData(n){var t=this;return(0,r.Z)(function*(){try{const a=JSON.parse(n),s=t.data.units.concat(a.units);return t.warbands=t.warbands.concat(a.warbands),yield t.data.setUnits(s),yield t.data.setWarbands(t.warbands),t.changes.emit(),!0}catch(a){return console.error("Error importing data:",a),!1}})()}importAndMergeUnitsOnly(n){var t=this;return(0,r.Z)(function*(){try{const a=JSON.parse(n),s=t.data.units.concat(a.units);return yield t.data.setUnits(s),t.changes.emit(),!0}catch(a){return console.error("Error importing data:",a),!1}})()}importAndMergeWarbandsOnly(n){var t=this;return(0,r.Z)(function*(){try{const a=JSON.parse(n);return t.warbands=t.warbands.concat(a.warbands),yield t.data.setWarbands(t.warbands),t.changes.emit(),!0}catch(a){return console.error("Error importing data:",a),!1}})()}importAndOverwriteData(n){var t=this;return(0,r.Z)(function*(){try{const a=JSON.parse(n),s=a.units;return t.warbands=a.warbands,t.enhancedUnitCostRule=a.enhancedUnitCostRule,yield t.data.setUnits(s),yield t.data.setWarbands(t.warbands),yield t.data.setEnhancedUnitCostRule(t.enhancedUnitCostRule),t.changes.emit(),!0}catch(a){return console.error("Error importing data:",a),!1}})()}generateID(){return Math.random().toString(36).substring(2,9)}addUnit(n){var t=this;return(0,r.Z)(function*(){const a=t.data.units.concat(n);yield t.data.setUnits(a),t.changes.emit()})()}purgeUnit(n){var t=this;return(0,r.Z)(function*(){const a=t.data.units.filter(s=>s.id!==n.id);t.warbands=t.warbands.map(s=>(s.units=s.units.filter(c=>c.unit.id!==n.id),s)),yield t.data.setUnits(a),yield t.data.setWarbands(t.warbands)})()}deleteUnit(n){var t=this;return(0,r.Z)(function*(){const a=t.data.units.filter(s=>s.id!==n.id);yield t.data.setUnits(a)})()}clearUnits(){var n=this;return(0,r.Z)(function*(){yield n.data.clearUnits(),n.changes.emit()})()}updateUnit(n){var t=this;return(0,r.Z)(function*(){t.data.updateUnit(n)})()}getUnitById(n){return this.data.getUnitById(n)}addWarband(n){var t=this;return(0,r.Z)(function*(){t.warbands.push(n),yield t.data.setWarbands(t.warbands)})()}getWarbands(){return this.warbands}createWarband(n){var t=this;return(0,r.Z)(function*(){const a={id:Date.now().toString(),...n};t.warbands.push(a),yield t.data.setWarbands(t.warbands)})()}updateWarband(n){var t=this;return(0,r.Z)(function*(){const a=t.warbands.findIndex(s=>s.id===n.id);a>-1&&(t.warbands[a]=n,yield t.data.setWarbands(t.warbands))})()}getWarbandById(n){const t=this.warbands.find(a=>a.id===n);return t?{...t}:null}removeWarband(n){var t=this;return(0,r.Z)(function*(){t.warbands=t.warbands.filter(a=>a!==n),yield t.data.setWarbands(t.warbands)})()}clearWarbands(){var n=this;return(0,r.Z)(function*(){yield n.data.clearWarbands(),n.warbands=[],n.changes.emit()})()}}return u.\u0275fac=function(n){return new(n||u)(l.LFG(i.D),l.LFG(_.m))},u.\u0275prov=l.Yz7({token:u,factory:u.\u0275fac,providedIn:"root"}),u})()}}]);