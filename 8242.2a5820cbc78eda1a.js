"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[8242],{3442:(b,l,o)=>{o.d(l,{k:()=>s});const s={6:5,5:10,4:20,3:35,2:55}},3623:(b,l,o)=>{o.d(l,{_:()=>e});var s=o(5861),c=o(1571),f=o(3442),u=o(849);let v=(()=>{class d{constructor(n){this.storage=n,this.whenLocked=new c.vpe,this.whenUnlocked=new c.vpe,this._startedInitialization=!1,this._locked=!0}initialize(){var n=this;return(0,s.Z)(function*(){n._startedInitialization||(n._startedInitialization=!0,yield n.storage.create(),yield n.loadDataFromStorage(),n.unlock())})()}get locked(){return this._locked}get units(){var n;if(this.locked)throw new Error("DataService is locked!");return(null===(n=this.data)||void 0===n?void 0:n.units)||[]}get warbands(){var n;if(this.locked)throw new Error("DataService is locked!");return(null===(n=this.data)||void 0===n?void 0:n.warbands)||[]}get enhancedUnitCostRule(){var n;if(this.locked)throw new Error("DataService is locked!");return(null===(n=this.data)||void 0===n?void 0:n.enhancedUnitCostRule)||!1}getUnitById(n){return this.units.find(i=>i.id===n)||null}setUnits(n){var t=this;return(0,s.Z)(function*(){t.lock()||t.whenLocked.subscribe(()=>{t.setUnits(n)}),t.data.units=n,yield t.saveDataToStorage(),t.unlock()})()}setWarbands(n){var t=this;return(0,s.Z)(function*(){t.lock()||t.whenLocked.subscribe(()=>{t.setWarbands(n)}),t.data.warbands=n,yield t.saveDataToStorage(),t.unlock()})()}setEnhancedUnitCostRule(n){var t=this;return(0,s.Z)(function*(){t.lock()||t.whenLocked.subscribe(()=>{t.setEnhancedUnitCostRule(n)}),t.data.enhancedUnitCostRule=n,yield t.saveDataToStorage(),t.unlock()})()}updateUnit(n){var t=this;return(0,s.Z)(function*(){t.lock()||t.whenLocked.subscribe(()=>{t.updateUnit(n)});const i=t.data.units.findIndex(a=>a.id===n.id);-1!==i&&(t.data.units[i]=n,yield t.saveDataToStorage()),t.unlock()})()}clearUnits(){var n=this;return(0,s.Z)(function*(){n.lock()||n.whenLocked.subscribe(()=>{n.clearUnits()}),n.data.units=[],yield n.saveDataToStorage(),n.unlock()})()}clearWarbands(){var n=this;return(0,s.Z)(function*(){n.lock()||n.whenLocked.subscribe(()=>{n.clearWarbands()}),n.data.warbands=[],yield n.saveDataToStorage(),n.unlock()})()}saveDataToStorage(){var n=this;return(0,s.Z)(function*(){var t,i,a;yield n.storage.set("units",null===(t=n.data)||void 0===t?void 0:t.units),yield n.storage.set("warbands",null===(i=n.data)||void 0===i?void 0:i.warbands),yield n.storage.set("enhancedUnitCostRule",null===(a=n.data)||void 0===a?void 0:a.enhancedUnitCostRule)})()}loadDataFromStorage(){var n=this;return(0,s.Z)(function*(){const t=(yield n.storage.get("units"))||[],i=(yield n.storage.get("warbands"))||[],a=(yield n.storage.get("enhancedUnitCostRule"))||!1;n.data={units:t,warbands:i,enhancedUnitCostRule:a}})()}lock(){return!this._locked&&(this._locked=!0,this.whenLocked.emit(),!0)}unlock(){return!!this._locked&&(this._locked=!1,this.whenUnlocked.emit(),!0)}}return d.\u0275fac=function(n){return new(n||d)(c.LFG(u.K))},d.\u0275prov=c.Yz7({token:d,factory:d.\u0275fac,providedIn:"root"}),d})(),e=(()=>{class d{constructor(n){this.data=n,this.changes=new c.vpe,this.warbands=[],this._startedInitialization=!1,this.enhancedUnitCostRule=!1,this.unitDraft=null}initialize(){var n=this;return(0,s.Z)(function*(){n._startedInitialization||(n._startedInitialization=!0,yield n.data.initialize(),n.warbands=n.data.warbands||[],n.enhancedUnitCostRule=n.data.enhancedUnitCostRule||!1)})()}checkInitialization(){if(!this._startedInitialization)throw new Error("You must call UnitService.initialize() before using this service!")}get units(){return this.data.units}calcUnitCost(n){this.checkInitialization();let t=f.k[n.rank];const i=n.edges.length;let r=0;for(let g=0;g<i;g++){const _=n.edges[g];_.cost>0&&(r++,this.enhancedUnitCostRule&&r>3&&(t+=10*(r-3))),t+=_.cost}return t}calcWarbandCost(n){this.checkInitialization();let t=0;for(let i of n.units)t+=this.calcUnitCost(i.unit)*i.count;return t}getRankCost(n){return this.checkInitialization(),f.k[n.rank]}setEnhancedUnitCostRule(n){var t=this;return(0,s.Z)(function*(){t.checkInitialization(),t.enhancedUnitCostRule=n,yield t.data.setEnhancedUnitCostRule(n),t.changes.emit()})()}getEnhancedUnitCostRule(){var n=this;return(0,s.Z)(function*(){return n.checkInitialization(),n.enhancedUnitCostRule=n.data.enhancedUnitCostRule||!1,n.enhancedUnitCostRule})()}exportData(){return JSON.stringify({units:this.data.units,warbands:this.warbands,enhancedUnitCostRule:this.enhancedUnitCostRule},null,2)}importAndMergeData(n){var t=this;return(0,s.Z)(function*(){t.checkInitialization();try{const i=JSON.parse(n),a=t.data.units.concat(i.units);return t.warbands=t.warbands.concat(i.warbands),yield t.data.setUnits(a),yield t.data.setWarbands(t.warbands),t.changes.emit(),!0}catch(i){return console.error("Error importing data:",i),!1}})()}importAndMergeUnitsOnly(n){var t=this;return(0,s.Z)(function*(){t.checkInitialization();try{const i=JSON.parse(n),a=t.data.units.concat(i.units);return yield t.data.setUnits(a),t.changes.emit(),!0}catch(i){return console.error("Error importing data:",i),!1}})()}importAndMergeWarbandsOnly(n){var t=this;return(0,s.Z)(function*(){t.checkInitialization();try{const i=JSON.parse(n);return t.warbands=t.warbands.concat(i.warbands),yield t.data.setWarbands(t.warbands),t.changes.emit(),!0}catch(i){return console.error("Error importing data:",i),!1}})()}importAndOverwriteData(n){var t=this;return(0,s.Z)(function*(){t.checkInitialization();try{const i=JSON.parse(n),a=i.units;return t.warbands=i.warbands,t.enhancedUnitCostRule=i.enhancedUnitCostRule,yield t.data.setUnits(a),yield t.data.setWarbands(t.warbands),yield t.data.setEnhancedUnitCostRule(t.enhancedUnitCostRule),t.changes.emit(),!0}catch(i){return console.error("Error importing data:",i),!1}})()}generateID(){return Math.random().toString(36).substring(2,9)}addUnit(n){var t=this;return(0,s.Z)(function*(){t.checkInitialization();const i=t.data.units.concat(n);yield t.data.setUnits(i),t.changes.emit()})()}purgeUnit(n){var t=this;return(0,s.Z)(function*(){t.checkInitialization();const i=t.data.units.filter(a=>a.id!==n.id);t.warbands=t.warbands.map(a=>(a.units=a.units.filter(r=>r.unit.id!==n.id),a)),yield t.data.setUnits(i),yield t.data.setWarbands(t.warbands)})()}deleteUnit(n){var t=this;return(0,s.Z)(function*(){const i=t.data.units.filter(a=>a.id!==n.id);yield t.data.setUnits(i)})()}clearUnits(){var n=this;return(0,s.Z)(function*(){yield n.data.clearUnits(),n.changes.emit()})()}updateUnit(n){var t=this;return(0,s.Z)(function*(){t.data.updateUnit(n)})()}getUnitById(n){return this.data.getUnitById(n)}addWarband(n){var t=this;return(0,s.Z)(function*(){t.checkInitialization(),t.warbands.push(n),yield t.data.setWarbands(t.warbands)})()}getWarbands(){return this.checkInitialization(),this.warbands}createWarband(n){var t=this;return(0,s.Z)(function*(){t.checkInitialization();const i={id:Date.now().toString(),...n};t.warbands.push(i),yield t.data.setWarbands(t.warbands)})()}updateWarband(n){var t=this;return(0,s.Z)(function*(){t.checkInitialization();const i=t.warbands.findIndex(a=>a.id===n.id);i>-1&&(t.warbands[i]=n,yield t.data.setWarbands(t.warbands))})()}getWarbandById(n){this.checkInitialization();const t=this.warbands.find(i=>i.id===n);return t?{...t}:null}removeWarband(n){var t=this;return(0,s.Z)(function*(){t.checkInitialization(),t.warbands=t.warbands.filter(i=>i!==n),yield t.data.setWarbands(t.warbands)})()}clearWarbands(){var n=this;return(0,s.Z)(function*(){n.checkInitialization(),yield n.data.clearWarbands(),n.warbands=[],n.changes.emit()})()}}return d.\u0275fac=function(n){return new(n||d)(c.LFG(v))},d.\u0275prov=c.Yz7({token:d,factory:d.\u0275fac,providedIn:"root"}),d})()},8242:(b,l,o)=>{o.r(l),o.d(l,{UnitViewPage:()=>n});var s=o(5861),c=o(6895),f=o(433),u=o(7151),v=o(4968),e=o(1571),d=o(3623);function h(t,i){if(1&t&&(e.TgZ(0,"li"),e._uU(1),e.qZA()),2&t){const a=i.$implicit;e.xp6(1),e.lnq(" ",a.name," (",a.cost,"pts): ",a.description," ")}}let n=(()=>{class t{constructor(a,r){this.modalController=a,this.unitService=r,this.backButton=null}ngOnInit(){var a=this;const r=(0,v.R)(document,"backbutton");this.backButton=r.subscribe((0,s.Z)(function*(){yield a.dismissModal()}))}ngOnDestroy(){var a;null===(a=this.backButton)||void 0===a||a.unsubscribe()}dismissModal(){var a=this;return(0,s.Z)(function*(){yield a.modalController.dismiss()})()}}return t.\u0275fac=function(a){return new(a||t)(e.Y36(u.IN),e.Y36(d._))},t.\u0275cmp=e.Xpm({type:t,selectors:[["app-unit-view"]],inputs:{unit:"unit"},standalone:!0,features:[e.jDz],decls:19,vars:7,consts:[["slot","end"],[3,"click"],[1,"unit-info"],[1,"unit-image",3,"src","alt"],[1,"unit-info-text"],[4,"ngFor","ngForOf"]],template:function(a,r){1&a&&(e.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),e._uU(3),e.qZA(),e.TgZ(4,"ion-buttons",0)(5,"ion-button",1),e.NdJ("click",function(){return r.dismissModal()}),e._uU(6,"Close"),e.qZA()()()(),e.TgZ(7,"ion-content")(8,"div",2),e._UZ(9,"img",3),e.TgZ(10,"div",4)(11,"p"),e._uU(12),e.qZA(),e.TgZ(13,"p"),e._uU(14),e.qZA(),e.TgZ(15,"p"),e._uU(16,"Edges:"),e.qZA(),e.TgZ(17,"ul"),e.YNc(18,h,2,3,"li",5),e.qZA()()()()),2&a&&(e.xp6(3),e.Oqu(r.unit.name),e.xp6(6),e.MGl("alt","",r.unit.name," image"),e.Q6J("src",r.unit.image||"assets/default-unit-image.png",e.LSH),e.xp6(3),e.hij("Total Cost: ",r.unitService.calcUnitCost(r.unit),"pts"),e.xp6(2),e.AsE("Rank: ",r.unit.rank,"+ (",r.unitService.getRankCost(r.unit),"pts)"),e.xp6(4),e.Q6J("ngForOf",r.unit.edges))},dependencies:[u.Pc,u.YG,u.Sm,u.W2,u.Gu,u.wd,u.sr,c.ez,c.sg,f.u5],styles:[".unit-image[_ngcontent-%COMP%]{max-width:100%;max-height:300px;object-fit:contain;display:block;margin:0 auto}.unit-info-text[_ngcontent-%COMP%]{margin-left:10px;margin-right:10px}"]}),t})()}}]);